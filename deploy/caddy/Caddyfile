{
  auto_https off
}

https://localhost {
  tls internal
  encode zstd gzip
  header {
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    Referrer-Policy "no-referrer"
    Content-Security-Policy "default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self'; connect-src 'self'"
  }

  @api path /api/*
  handle @api {
    reverse_proxy quietvector-api:8090 {
      header_up X-Forwarded-Proto https
      header_up X-Forwarded-Host {host}
    }
  }

  handle {
    root * /srv
    file_server
    try_files {path} {path}/ /index.html
    reverse_proxy quietvector-web:80
  }
}
